<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Sets the character encoding of the document to UTF-8, ensuring proper rendering of international characters and symbols -->
  <meta charset="UTF-8">
  <title>All Posts</title>
  <!-- CSS Link -->
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Boxicons CDN Link, Used to load the icons -->
  <script src="https://kit.fontawesome.com/14f233c83a.js" crossorigin="anonymous"></script>
  <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>
  <div class="sidebar">
    <div class="logo-details">
      <img src="images/logo.png" class="icon">
      <div class="logo_name">Club Mangment</div>
      <i class='bx bx-menu' id="btn"></i>
    </div>
    <ul class="nav-list">
      <li>
        <a href="../home/home.html">
          <i class='bx bx-home'></i>
          <span class="links_name">Home</span>
        </a>
        <span class="tooltip">Home</span>
      </li>
      <li>
        <a href="../weekly-events/weekly-Events.html">
          <i class='bx bx-calendar-event'></i>
          <span class="links_name">Weekly activities</span>
        </a>
        <span class="tooltip">Weekly activities</span>
      </li>
      <li class="profile">
        <div class="profile-details">
          <img src="images/profile.png" alt="profileImg">
          <div class="name_job">
            <div class="name">Micheal salman</div>
            <div class="job">Student</div>
          </div>
        </div>
        <div>
          <a href="../Log-in page/Club_Member.html">
            <i class='bx bx-log-out' id="log_out">

            </i>
          </a>
        </div>
      </li>
    </ul>
  </div>

  <div class="home-section">

    <div class="text">
     All Posts
    </div>

  </header>
  <main>

    <div class="search-container">
      <div class="date-container">
         <input type="date" name="date" id="date" class="date-input">
       </div>
   
   
       
        <div class="category-container">
          <div class="select-btn">
            <span class="btn-text">
              select 
            </span>
            <span class="arrow-dwn">
              <i class="fa-solid fa-chevron-down"></i>
            </span>
          </div>
   
          <ul class="list-items">
             <li class="item"> 
               <span class="checkbox">
                   <i class="fa-solid fa-check check-icon"></i>
               </span>
               <span class="item-text">
                 MATH
               </span>
             </li>
          </ul>
        </div>
   
   
   
        <div class="search-form-container">
             <input type="text" class="input" placeholder="search" id="search">
             <button type="submit" class="button" id="submit">Search</button>
         </div>
     </div>
     <div class="gallery" id="post-gallery">
      <!-- Cards will be dynamically inserted here -->
  </div>

  <script>
      // Function to fetch data from the server and create post cards
      async function fetchPosts() {
          try {
              // Fetch data from the server
              const response = await fetch('/api/Post/getAllPosts');
              const chunkedPosts = await response.json(); // Parse the JSON response

              // Get the gallery container where cards will be inserted
              const gallery = document.getElementById('post-gallery');

              // Iterate over the posts and create a card for each
              chunkedPosts.forEach((posts, index) => {
                posts.forEach(post=>{
                  // Create a card element
                  const card = document.createElement('div');
                  card.classList.add('grid-colum-span');
                  
                  // Set the ID for each card to be distinct
                  card.id = `post-card-${index}`;

                  // Set the card content
                  card.innerHTML = `
                      <a href="" id="post-card-link">
                          <div class="postCard">
                              <div class="dateBlock">
                                  <p class="day"><span id="post-day">${new Date(post.postDate).getDate()}</span>th</p>
                                  <p class="month"><span id="post-month">${new Date(post.postDate).toLocaleString('default', { month: 'short' })}</span></p>
                                  <p class="year"><span id="post-year">${new Date(post.postDate).getFullYear()}</span></p>
                              </div>
                              <div class="titleBlock">
                                  <h3 id="post-title">${post.postTitle}</h3>
                              </div>
                          </div>
                      </a>
                  `;

                  // Append the card to the gallery
                  gallery.appendChild(card);

                  // Add a click event listener to the card to handle redirection
                  card.addEventListener("click", function() {
                      // Redirect to the post details page
                      window.location.href = "../Post_details/Post_details.html";
                  });
                })
              });
          } catch (error) {
              console.error('Error fetching posts:', error);
          }
      }

      // Fetch posts when the page loads
      window.addEventListener('load', fetchPosts);
  </script>
    </main>
  </div>
  <script src="script.js"> </script>
</body>
</html>